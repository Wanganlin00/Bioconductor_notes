[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Bioconductor_notes",
    "section": "",
    "text": "前言"
  },
  {
    "objectID": "index.html#写在前面",
    "href": "index.html#写在前面",
    "title": "Bioconductor_notes",
    "section": "写在前面",
    "text": "写在前面\n这是一本关于单细胞分析的笔记，主要是关于这本书《Orchestrating Single-Cell Analysis with Bioconductor》。\n了解更多：Orchestrating Single-Cell Analysis with Bioconductor。\n本书包括五个部分：\n\nIntroduction\nBasics\nAdvanced\nMulti-sample\nWorkflow"
  },
  {
    "objectID": "index.html#配置环境",
    "href": "index.html#配置环境",
    "title": "Bioconductor_notes",
    "section": "配置环境",
    "text": "配置环境\n\nCodedevtools::session_info()[1]\n#&gt; $platform\n#&gt;  setting  value\n#&gt;  version  R version 4.3.2 (2023-10-31 ucrt)\n#&gt;  os       Windows 10 x64 (build 19045)\n#&gt;  system   x86_64, mingw32\n#&gt;  ui       RTerm\n#&gt;  language en\n#&gt;  collate  Chinese (Simplified)_China.utf8\n#&gt;  ctype    Chinese (Simplified)_China.utf8\n#&gt;  tz       Asia/Shanghai\n#&gt;  date     2023-12-23\n#&gt;  pandoc   3.1.1 @ D:/RStudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)\nBiocManager::version()\n#&gt; [1] '3.18'\n\n\n\npackagesBiocManager::install(\"OSCA.intro\")"
  },
  {
    "objectID": "intro.html",
    "href": "intro.html",
    "title": "Introduction",
    "section": "",
    "text": "第一部分 Introduction\n包括：\n\n获取scRNA-seq数据集\n`SingleCellExpreiment`结构\n分析概述\n\nC:\\Users\\DELL\\AppData\\Local/R/cache/R/"
  },
  {
    "objectID": "import.html#实验设计",
    "href": "import.html#实验设计",
    "title": "\n1  获取scRNA-seq数据集\n",
    "section": "\n1.1 实验设计",
    "text": "1.1 实验设计\nscRNA-Seq experimental protocols：\n\n基于液滴的方案，高通量，低成本，如10X Genomics、inDrop和Drop-seq；\n基于平板的方案，捕获其他表型信息（如形态学），并且更易于自定义\n基于UMI的平板方案，减轻了PCR扩增噪声的影响，如CEL-seq（2）和MARS-seq；\n基于读取的平板方案，提供全转录覆盖，（如剪接、外显子组突变），主要是Smart-seq2；\n其他方案，如sciRNA-seq。\n\n捕获细胞数目和测序深度"
  },
  {
    "objectID": "import.html#创建计数矩阵",
    "href": "import.html#创建计数矩阵",
    "title": "\n1  获取scRNA-seq数据集\n",
    "section": "\n1.2 创建计数矩阵",
    "text": "1.2 创建计数矩阵\nCellranger\nalevin"
  },
  {
    "objectID": "import.html#导入计数矩阵",
    "href": "import.html#导入计数矩阵",
    "title": "\n1  获取scRNA-seq数据集\n",
    "section": "\n1.3 导入计数矩阵",
    "text": "1.3 导入计数矩阵\n\n1.3.1 从表格格式\n从csv 文件导入计数矩阵，点击下载胰腺scRNA-seq数据集：GSE85241_cellsystems_dataset_4donors_updated.csv.gz(HTTP) 解压到data文件夹\n\nCodemat &lt;- as.matrix(read.delim(\"data/GSE85241_cellsystems_dataset_4donors_updated.csv\"))\ndim(mat)\n#&gt; [1] 19140  3072\n\n\n使用 scuttle 包中的函数以稀疏格式(sparse format)读取表。这仅存储非零值，并避免在低测序的scRNA-seq实验中将内存花费在大多数零上\n\nCodesparse.mat &lt;- readSparseCounts(\"data/GSE85241_cellsystems_dataset_4donors_updated.csv\")\ndim(sparse.mat)\n#&gt; [1] 19140  3072\n\n\n比较两种方法的内存大小,查看Environment中的size大小，或者\n\nCodeobject.size(sparse.mat)\n#&gt; 150978872 bytes\nobject.size(mat)\n#&gt; 471999152 bytes\n\n\n从Excel 文件中导入计数矩阵,点击下载：GSE61533_HTSEQ_count_results.xls.gz(HTTP)解压到data文件夹\n\nCodelibrary(readxl)\nall.counts &lt;- read_excel(\"data/GSE61533_HTSEQ_count_results.xls\")\ngene.names &lt;- all.counts$ID\nall.counts &lt;- as.matrix(all.counts[,-1])\nrownames(all.counts) &lt;- gene.names\ndim(all.counts)\n#&gt; [1] 38498    96\n\n\n\n1.3.2 从 Cellranger 输出\n对于 10X Genomics 数据，Cellranger 软件套件将生成一个包含计数和特征/条形码注释的输出目录。 点击下载：Gene / cell matrix (filtered)\n\nCodelibrary(DropletUtils)\nsce &lt;- read10xCounts(\"data/filtered_gene_bc_matrices/GRCh38\")\nsce\n#&gt; class: SingleCellExperiment \n#&gt; dim: 33694 4340 \n#&gt; metadata(1): Samples\n#&gt; assays(1): counts\n#&gt; rownames(33694): ENSG00000243485 ENSG00000237613 ... ENSG00000277475\n#&gt;   ENSG00000268674\n#&gt; rowData names(2): ID Symbol\n#&gt; colnames: NULL\n#&gt; colData names(2): Sample Barcode\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\n\n\n通过将多个目录路径传递给read10xCounts()来读取多个计数矩阵。如果所有数据集都具有相同的基因注释，则该函数将能够将它们组合到单个对象中。\n\nCodedirA &lt;- \"data/filtered_gene_bc_matrices/GRCh38\"\ndirB &lt;- \"data/filtered_gene_bc_matrices - 副本/GRCh38\" #复制 \nsce &lt;- read10xCounts(c(dirA, dirB))\nsce\n#&gt; class: SingleCellExperiment \n#&gt; dim: 33694 8680 \n#&gt; metadata(1): Samples\n#&gt; assays(1): counts\n#&gt; rownames(33694): ENSG00000243485 ENSG00000237613 ... ENSG00000277475\n#&gt;   ENSG00000268674\n#&gt; rowData names(2): ID Symbol\n#&gt; colnames: NULL\n#&gt; colData names(2): Sample Barcode\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\n\n\n\n1.3.3 来自基于 HDF5 的格式\n一系列scRNA-seq存储格式基于分层数据格式第5版（HDF5）,无需将所有数据读入 R 即可进行基于bioconductor的分析,这使得在计算机内存有限的情况下分析非常大的数据集。 这些格式能够在同一文件中存储表达值以及相关的基因和细胞注释。\n这种方法的一种风格是 H5AD 格式。点击下载：Gene / cell matrix HDF5 (raw)\n\nCodelibrary(zellkonverter)\ndemo &lt;- system.file(\"extdata\", \"krumsiek11.h5ad\", package = \"zellkonverter\")\nsce &lt;- zellkonverter::readH5AD(demo)\nsce\n\n\n另一种风格是Loom 文件格式\n\nCodelibrary(LoomExperiment,quietly = TRUE)\ndemo &lt;- system.file(\"extdata\", \"L1_DRG_20_example.loom\", package = \"LoomExperiment\")\nscle &lt;- import(demo, type=\"SingleCellLoomExperiment\")\nscle\n#&gt; class: SingleCellLoomExperiment \n#&gt; dim: 20 20 \n#&gt; metadata(4): CreatedWith LOOM_SPEC_VERSION LoomExperiment-class\n#&gt;   MatrixName\n#&gt; assays(1): matrix\n#&gt; rownames: NULL\n#&gt; rowData names(7): Accession Gene ... X_Total X_Valid\n#&gt; colnames: NULL\n#&gt; colData names(103): Age AnalysisPool ... cDNA_Lib_Ok ngperul_cDNA\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\n#&gt; rowGraphs(0): NULL\n#&gt; colGraphs(2): KNN MKNN"
  },
  {
    "objectID": "SCE.html#概述",
    "href": "SCE.html#概述",
    "title": "2  SingleCellExperiment结构",
    "section": "\n2.1 概述",
    "text": "2.1 概述\nSingleCellExperiment结构如下图 图 2.1 所示。它实现了一个数据结构，用于存储单细胞数据的所有方面——逐细胞基因表达数据、每细胞元数据和每基因注释——并以同步的方式对其进行操作。\n\n\n图 2.1: `SingleCellExperiment `的结构概述。assays的每一行对应于 rowData（粉红色阴影）的一行，而assays的每一列对应于 colData 和 reducedDims（黄色阴影）的一行\n\n下载SingleCellExperiment包\n\nCodeBiocManager::install('SingleCellExperiment')\n\n\n载入SingleCellExperiment包\n\nCodelibrary(SingleCellExperiment)"
  },
  {
    "objectID": "SCE.html#存储主要数据primar-data",
    "href": "SCE.html#存储主要数据primar-data",
    "title": "2  SingleCellExperiment结构",
    "section": "\n2.2 存储主要数据（primar data）",
    "text": "2.2 存储主要数据（primar data）\n\n2.2.1 填充assays slot\n要构造一个SingleCellExperiment对象，我们只需要填充assays。 这包含原始数据，例如测序计数矩阵，其中行对应于特征（基因），列对应于样本（细胞）（ 图 2.1 ，蓝色框）。点击下载：counts_Calero_20160113.tsv。\n\nCodedf &lt;- read_tsv(\"data/counts_Calero_20160113.tsv\")\n\n# 只考虑内源性基因\nspike.df &lt;- df[str_detect(df$GeneID,\"^ERCC-\"),] #正则表达式，查询外源RNA\ndf&lt;- df[str_detect(df$GeneID,\"^ENSMUSG\"),]  #正则表达式，内源性RNA\ngene.length &lt;- df$Length\n\n# 计数矩阵\nmat&lt;- as.matrix(df[,-c(1,2)]) \nrow.names(mat) &lt;- df$GeneID\ndim(mat)\n#&gt; [1] 46603    96\n\n\n\n\n\n\n\n\nERCC = External RNA Controls Consortium ERCC就是一个专门为了定制一套spike-in RNA而成立的组织。\n\n\n\n由此，我们现在可以使用函数SingleCellExperiment()构造对象，以命名列表的形式提供数据，其中列表的每个条目都是一个矩阵。\n\nCode#?SingleCellExperiment\nsce &lt;- SingleCellExperiment(assays = list(counts = mat))\nsce\n#&gt; class: SingleCellExperiment \n#&gt; dim: 46603 96 \n#&gt; metadata(0):\n#&gt; assays(1): counts\n#&gt; rownames(46603): ENSMUSG00000102693 ENSMUSG00000064842 ...\n#&gt;   ENSMUSG00000096730 ENSMUSG00000095742\n#&gt; rowData names(0):\n#&gt; colnames(96): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...\n#&gt;   SLX-9555.N712_S508.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N712_S517.C89V9ANXX.s_1.r_1\n#&gt; colData names(0):\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\n\n\n#访问计数数据\nmat2 &lt;- assay(sce, \"counts\")  #通用\nmat3 &lt;- counts(sce)           #特殊名称 counts  \n\n\n\n2.2.2 添加assays slot\n\nCodesce &lt;- scuttle::logNormCounts(sce) #对数变换归一化表达矩阵\nsce    #  assays 多了一个  \"logcounts\"\n#&gt; class: SingleCellExperiment \n#&gt; dim: 46603 96 \n#&gt; metadata(0):\n#&gt; assays(2): counts logcounts\n#&gt; rownames(46603): ENSMUSG00000102693 ENSMUSG00000064842 ...\n#&gt;   ENSMUSG00000096730 ENSMUSG00000095742\n#&gt; rowData names(0):\n#&gt; colnames(96): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...\n#&gt;   SLX-9555.N712_S508.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N712_S517.C89V9ANXX.s_1.r_1\n#&gt; colData names(1): sizeFactor\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\n\ndim(logcounts(sce))\n#&gt; [1] 46603    96\n\n\n自定义添加\n\nCodecounts_100 &lt;- counts(sce) + 100\nassay(sce, \"counts_100\") &lt;- counts_100 # assign a new entry to assays slot\nassays(sce) # new assay has now been added.\n#&gt; List of length 3\n#&gt; names(3): counts logcounts counts_100\nsce\n#&gt; class: SingleCellExperiment \n#&gt; dim: 46603 96 \n#&gt; metadata(0):\n#&gt; assays(3): counts logcounts counts_100\n#&gt; rownames(46603): ENSMUSG00000102693 ENSMUSG00000064842 ...\n#&gt;   ENSMUSG00000096730 ENSMUSG00000095742\n#&gt; rowData names(0):\n#&gt; colnames(96): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...\n#&gt;   SLX-9555.N712_S508.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N712_S517.C89V9ANXX.s_1.r_1\n#&gt; colData names(1): sizeFactor\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\n\n\n访问和操纵\n\nCodeassays(sce)\n#&gt; List of length 3\n#&gt; names(3): counts logcounts counts_100\n\n# Only keeping the first two assays\nassays(sce) &lt;- assays(sce)[1:2]\nsce\n#&gt; class: SingleCellExperiment \n#&gt; dim: 46603 96 \n#&gt; metadata(0):\n#&gt; assays(2): counts logcounts\n#&gt; rownames(46603): ENSMUSG00000102693 ENSMUSG00000064842 ...\n#&gt;   ENSMUSG00000096730 ENSMUSG00000095742\n#&gt; rowData names(0):\n#&gt; colnames(96): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...\n#&gt;   SLX-9555.N712_S508.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N712_S517.C89V9ANXX.s_1.r_1\n#&gt; colData names(1): sizeFactor\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\n\nassayNames(sce)\n#&gt; [1] \"counts\"    \"logcounts\"\nnames(assays(sce))\n#&gt; [1] \"counts\"    \"logcounts\""
  },
  {
    "objectID": "SCE.html#处理元数据metadata",
    "href": "SCE.html#处理元数据metadata",
    "title": "2  SingleCellExperiment结构",
    "section": "\n2.3 处理元数据（metadata）",
    "text": "2.3 处理元数据（metadata）\n\n2.3.1 colData（cell metadata）\n为了进一步注释对象SingleCellExperiment，可以添加列元数据来描述我们primary data的列，例如我们实验的样本或细胞。 这些存储在colDataslot中，该对象DataFrame中的行对应于细胞，列对应于元数据字段，例如原产地批次batch of origin、处理条件treatment condition等（ 图 2.1，橙色框）。点击下载：E-MTAB-5522.sdrf.txt（第2页）\n\nCodecoldata &lt;- read_tsv(\"data/E-MTAB-5522.sdrf.txt\")\n\n# 仅保留在计数矩阵 mat 中的细胞  第44列==\"counts_Calero_20160113.tsv\"\ncoldata &lt;- coldata[coldata$`Derived Array Data File`==\"counts_Calero_20160113.tsv\",]\n\n# 仅保留部分列和设置行标识符\ncoldata &lt;- DataFrame(\n  genotype=coldata$`Characteristics[genotype]`,\n  phenotype=coldata$`Characteristics[phenotype]`,\n  spike_in=coldata$`Factor Value[spike-in addition]`,\n  row.names = coldata$`Source Name`\n)\ncoldata\n#&gt; DataFrame with 96 rows and 3 columns\n#&gt;                                                    genotype\n#&gt;                                                 &lt;character&gt;\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N701_S506.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; ...                                                     ...\n#&gt; SLX-9555.N712_S505.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N712_S506.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N712_S507.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N712_S508.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N712_S517.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt;                                                   phenotype    spike_in\n#&gt;                                                 &lt;character&gt; &lt;character&gt;\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1    wild type phenotype   ERCC+SIRV\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1    wild type phenotype   ERCC+SIRV\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1    wild type phenotype   ERCC+SIRV\n#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   ERCC+SIRV\n#&gt; SLX-9555.N701_S506.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   ERCC+SIRV\n#&gt; ...                                                     ...         ...\n#&gt; SLX-9555.N712_S505.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..    Premixed\n#&gt; SLX-9555.N712_S506.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..    Premixed\n#&gt; SLX-9555.N712_S507.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..    Premixed\n#&gt; SLX-9555.N712_S508.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..    Premixed\n#&gt; SLX-9555.N712_S517.C89V9ANXX.s_1.r_1    wild type phenotype    Premixed\n\n\n\nCodestopifnot(identical(rownames(coldata), colnames(mat)))\n\n\n两种方法\n\n\n从头开始\n\n\nCodesce &lt;- SingleCellExperiment(assays = list(counts=mat), colData=coldata)\nsce\n#&gt; class: SingleCellExperiment \n#&gt; dim: 46603 96 \n#&gt; metadata(0):\n#&gt; assays(1): counts\n#&gt; rownames(46603): ENSMUSG00000102693 ENSMUSG00000064842 ...\n#&gt;   ENSMUSG00000096730 ENSMUSG00000095742\n#&gt; rowData names(0):\n#&gt; colnames(96): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...\n#&gt;   SLX-9555.N712_S508.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N712_S517.C89V9ANXX.s_1.r_1\n#&gt; colData names(3): genotype phenotype spike_in\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\n\ncolData(sce)\n#&gt; DataFrame with 96 rows and 3 columns\n#&gt;                                                    genotype\n#&gt;                                                 &lt;character&gt;\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N701_S506.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; ...                                                     ...\n#&gt; SLX-9555.N712_S505.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N712_S506.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N712_S507.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N712_S508.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt; SLX-9555.N712_S517.C89V9ANXX.s_1.r_1 Doxycycline-inducibl..\n#&gt;                                                   phenotype    spike_in\n#&gt;                                                 &lt;character&gt; &lt;character&gt;\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1    wild type phenotype   ERCC+SIRV\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1    wild type phenotype   ERCC+SIRV\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1    wild type phenotype   ERCC+SIRV\n#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   ERCC+SIRV\n#&gt; SLX-9555.N701_S506.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   ERCC+SIRV\n#&gt; ...                                                     ...         ...\n#&gt; SLX-9555.N712_S505.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..    Premixed\n#&gt; SLX-9555.N712_S506.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..    Premixed\n#&gt; SLX-9555.N712_S507.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..    Premixed\n#&gt; SLX-9555.N712_S508.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..    Premixed\n#&gt; SLX-9555.N712_S517.C89V9ANXX.s_1.r_1    wild type phenotype    Premixed\nsce$spike_in\n#&gt;  [1] \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\"\n#&gt;  [7] \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\"\n#&gt; [13] \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\"\n#&gt; [19] \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\"\n#&gt; [25] \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\" \"ERCC+SIRV\"\n#&gt; [31] \"ERCC+SIRV\" \"ERCC+SIRV\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\"\n#&gt; [37] \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\"\n#&gt; [43] \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\"\n#&gt; [49] \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\"\n#&gt; [55] \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\"\n#&gt; [61] \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"SIRV+ERCC\" \"Premixed\"  \"Premixed\" \n#&gt; [67] \"Premixed\"  \"Premixed\"  \"Premixed\"  \"Premixed\"  \"Premixed\"  \"Premixed\" \n#&gt; [73] \"Premixed\"  \"Premixed\"  \"Premixed\"  \"Premixed\"  \"Premixed\"  \"Premixed\" \n#&gt; [79] \"Premixed\"  \"Premixed\"  \"Premixed\"  \"Premixed\"  \"Premixed\"  \"Premixed\" \n#&gt; [85] \"Premixed\"  \"Premixed\"  \"Premixed\"  \"Premixed\"  \"Premixed\"  \"Premixed\" \n#&gt; [91] \"Premixed\"  \"Premixed\"  \"Premixed\"  \"Premixed\"  \"Premixed\"  \"Premixed\"\n\n\n\n\n\n向现有对象添加\n\n\nCodesce &lt;- SingleCellExperiment(list(counts=mat))\nsce\n#&gt; class: SingleCellExperiment \n#&gt; dim: 46603 96 \n#&gt; metadata(0):\n#&gt; assays(1): counts\n#&gt; rownames(46603): ENSMUSG00000102693 ENSMUSG00000064842 ...\n#&gt;   ENSMUSG00000096730 ENSMUSG00000095742\n#&gt; rowData names(0):\n#&gt; colnames(96): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...\n#&gt;   SLX-9555.N712_S508.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N712_S517.C89V9ANXX.s_1.r_1\n#&gt; colData names(0):\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\n\ncolData(sce) &lt;- coldata\n\nsce\n#&gt; class: SingleCellExperiment \n#&gt; dim: 46603 96 \n#&gt; metadata(0):\n#&gt; assays(1): counts\n#&gt; rownames(46603): ENSMUSG00000102693 ENSMUSG00000064842 ...\n#&gt;   ENSMUSG00000096730 ENSMUSG00000095742\n#&gt; rowData names(0):\n#&gt; colnames(96): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...\n#&gt;   SLX-9555.N712_S508.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N712_S517.C89V9ANXX.s_1.r_1\n#&gt; colData names(3): genotype phenotype spike_in\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\n\n\n\n或者\n\n\nCodesce &lt;- SingleCellExperiment(list(counts=mat))\nsce$phenotype &lt;- coldata$phenotype\ncolData(sce)\n#&gt; DataFrame with 96 rows and 1 column\n#&gt;                                                   phenotype\n#&gt;                                                 &lt;character&gt;\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1    wild type phenotype\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1    wild type phenotype\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1    wild type phenotype\n#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..\n#&gt; SLX-9555.N701_S506.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..\n#&gt; ...                                                     ...\n#&gt; SLX-9555.N712_S505.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..\n#&gt; SLX-9555.N712_S506.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..\n#&gt; SLX-9555.N712_S507.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..\n#&gt; SLX-9555.N712_S508.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..\n#&gt; SLX-9555.N712_S517.C89V9ANXX.s_1.r_1    wild type phenotype\n\n\n\n\n\n某些函数通过返回带有额外字段的SingleCellExperiment 结构在colData中自动添加列元数据，\n\nCode\nsce &lt;- scuttle::addPerCellQC(sce)  #quality control metrics质量控制指标\ncolData(sce)\n#&gt; DataFrame with 96 rows and 4 columns\n#&gt;                                                   phenotype       sum  detected\n#&gt;                                                 &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt;\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1    wild type phenotype    854171      7617\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1    wild type phenotype   1044243      7520\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1    wild type phenotype   1152450      8305\n#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   1193876      8142\n#&gt; SLX-9555.N701_S506.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   1521472      7153\n#&gt; ...                                                     ...       ...       ...\n#&gt; SLX-9555.N712_S505.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..    203221      5608\n#&gt; SLX-9555.N712_S506.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   1059853      6948\n#&gt; SLX-9555.N712_S507.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   1672343      6879\n#&gt; SLX-9555.N712_S508.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   1939537      7213\n#&gt; SLX-9555.N712_S517.C89V9ANXX.s_1.r_1    wild type phenotype   1436899      8469\n#&gt;                                          total\n#&gt;                                      &lt;numeric&gt;\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1    854171\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1   1044243\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1   1152450\n#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1   1193876\n#&gt; SLX-9555.N701_S506.C89V9ANXX.s_1.r_1   1521472\n#&gt; ...                                        ...\n#&gt; SLX-9555.N712_S505.C89V9ANXX.s_1.r_1    203221\n#&gt; SLX-9555.N712_S506.C89V9ANXX.s_1.r_1   1059853\n#&gt; SLX-9555.N712_S507.C89V9ANXX.s_1.r_1   1672343\n#&gt; SLX-9555.N712_S508.C89V9ANXX.s_1.r_1   1939537\n#&gt; SLX-9555.N712_S517.C89V9ANXX.s_1.r_1   1436899\nsce\n#&gt; class: SingleCellExperiment \n#&gt; dim: 46603 96 \n#&gt; metadata(0):\n#&gt; assays(1): counts\n#&gt; rownames(46603): ENSMUSG00000102693 ENSMUSG00000064842 ...\n#&gt;   ENSMUSG00000096730 ENSMUSG00000095742\n#&gt; rowData names(0):\n#&gt; colnames(96): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...\n#&gt;   SLX-9555.N712_S508.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N712_S517.C89V9ANXX.s_1.r_1\n#&gt; colData names(4): phenotype sum detected total\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\n\n\n\n2.3.2 rowData(feature metadata)\n特征注释存储在rowData slot 中，DataFrame中每行对应一个基因，并包含转录物长度或基因符号等注释。\n\nCoderowData(sce)$Length &lt;- gene.length\nrowData(sce)\n#&gt; DataFrame with 46603 rows and 1 column\n#&gt;                       Length\n#&gt;                    &lt;numeric&gt;\n#&gt; ENSMUSG00000102693      1070\n#&gt; ENSMUSG00000064842       110\n#&gt; ENSMUSG00000051951      6094\n#&gt; ENSMUSG00000102851       480\n#&gt; ENSMUSG00000103377      2819\n#&gt; ...                      ...\n#&gt; ENSMUSG00000094431       100\n#&gt; ENSMUSG00000094621       121\n#&gt; ENSMUSG00000098647        99\n#&gt; ENSMUSG00000096730      3077\n#&gt; ENSMUSG00000095742       243\n\n\n某些函数将返回一个rowData填充了相关信息位的SingleCellExperiment\n\nCodesce &lt;- scuttle::addPerFeatureQC(sce)\nrowData(sce)\n#&gt; DataFrame with 46603 rows and 3 columns\n#&gt;                       Length      mean  detected\n#&gt;                    &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;\n#&gt; ENSMUSG00000102693      1070 0.0000000   0.00000\n#&gt; ENSMUSG00000064842       110 0.0000000   0.00000\n#&gt; ENSMUSG00000051951      6094 0.0000000   0.00000\n#&gt; ENSMUSG00000102851       480 0.0000000   0.00000\n#&gt; ENSMUSG00000103377      2819 0.0208333   1.04167\n#&gt; ...                      ...       ...       ...\n#&gt; ENSMUSG00000094431       100         0         0\n#&gt; ENSMUSG00000094621       121         0         0\n#&gt; ENSMUSG00000098647        99         0         0\n#&gt; ENSMUSG00000096730      3077         0         0\n#&gt; ENSMUSG00000095742       243         0         0\n\n\n\n2.3.3 rowRanges\n\n此外，还有一个特殊的 slot rowRanges，用于以 GRanges或GRangesList的形式保存基因组坐标。 该存储描述了特征（基因、基因组区域）的染色体、起始坐标和结束坐标，这些特征可以通过 GenomicRanges框架轻松查询和操作。\n\nCodeSummarizedExperiment::rowRanges(sce)  #empty\n#&gt; GRangesList object of length 46603:\n#&gt; $ENSMUSG00000102693\n#&gt; GRanges object with 0 ranges and 0 metadata columns:\n#&gt;    seqnames    ranges strand\n#&gt;       &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;\n#&gt;   -------\n#&gt;   seqinfo: no sequences\n#&gt; \n#&gt; $ENSMUSG00000064842\n#&gt; GRanges object with 0 ranges and 0 metadata columns:\n#&gt;    seqnames    ranges strand\n#&gt;       &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;\n#&gt;   -------\n#&gt;   seqinfo: no sequences\n#&gt; \n#&gt; $ENSMUSG00000051951\n#&gt; GRanges object with 0 ranges and 0 metadata columns:\n#&gt;    seqnames    ranges strand\n#&gt;       &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;\n#&gt;   -------\n#&gt;   seqinfo: no sequences\n#&gt; \n#&gt; ...\n#&gt; &lt;46600 more elements&gt;\n\n\n填充 rowRanges的方式取决于在比对和定量过程中使用的生物体和注释。 在这里，我们有 Ensembl 标识符，因此我们可以使用rtracklayer从包含 Ensembl 注释的 GTF 文件中载入GRanges。点击下载：Mus_musculus.GRCm38.82.gtf.gz\n\nCodegene.data &lt;- rtracklayer::import(\"data/Mus_musculus.GRCm38.82.gtf.gz\")\nhead(gene.data)\n#&gt; GRanges object with 6 ranges and 26 metadata columns:\n#&gt;       seqnames          ranges strand |   source       type     score     phase\n#&gt;          &lt;Rle&gt;       &lt;IRanges&gt;  &lt;Rle&gt; | &lt;factor&gt;   &lt;factor&gt; &lt;numeric&gt; &lt;integer&gt;\n#&gt;   [1]        1 3073253-3074322      + |  havana  gene              NA      &lt;NA&gt;\n#&gt;   [2]        1 3073253-3074322      + |  havana  transcript        NA      &lt;NA&gt;\n#&gt;   [3]        1 3073253-3074322      + |  havana  exon              NA      &lt;NA&gt;\n#&gt;   [4]        1 3102016-3102125      + |  ensembl gene              NA      &lt;NA&gt;\n#&gt;   [5]        1 3102016-3102125      + |  ensembl transcript        NA      &lt;NA&gt;\n#&gt;   [6]        1 3102016-3102125      + |  ensembl exon              NA      &lt;NA&gt;\n#&gt;                  gene_id gene_version     gene_name gene_source gene_biotype\n#&gt;              &lt;character&gt;  &lt;character&gt;   &lt;character&gt; &lt;character&gt;  &lt;character&gt;\n#&gt;   [1] ENSMUSG00000102693            1 4933401J01Rik      havana          TEC\n#&gt;   [2] ENSMUSG00000102693            1 4933401J01Rik      havana          TEC\n#&gt;   [3] ENSMUSG00000102693            1 4933401J01Rik      havana          TEC\n#&gt;   [4] ENSMUSG00000064842            1       Gm26206     ensembl        snRNA\n#&gt;   [5] ENSMUSG00000064842            1       Gm26206     ensembl        snRNA\n#&gt;   [6] ENSMUSG00000064842            1       Gm26206     ensembl        snRNA\n#&gt;              havana_gene havana_gene_version      transcript_id\n#&gt;              &lt;character&gt;         &lt;character&gt;        &lt;character&gt;\n#&gt;   [1] OTTMUSG00000049935                   1               &lt;NA&gt;\n#&gt;   [2] OTTMUSG00000049935                   1 ENSMUST00000193812\n#&gt;   [3] OTTMUSG00000049935                   1 ENSMUST00000193812\n#&gt;   [4]               &lt;NA&gt;                &lt;NA&gt;               &lt;NA&gt;\n#&gt;   [5]               &lt;NA&gt;                &lt;NA&gt; ENSMUST00000082908\n#&gt;   [6]               &lt;NA&gt;                &lt;NA&gt; ENSMUST00000082908\n#&gt;       transcript_version   transcript_name transcript_source transcript_biotype\n#&gt;              &lt;character&gt;       &lt;character&gt;       &lt;character&gt;        &lt;character&gt;\n#&gt;   [1]               &lt;NA&gt;              &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;\n#&gt;   [2]                  1 4933401J01Rik-001            havana                TEC\n#&gt;   [3]                  1 4933401J01Rik-001            havana                TEC\n#&gt;   [4]               &lt;NA&gt;              &lt;NA&gt;              &lt;NA&gt;               &lt;NA&gt;\n#&gt;   [5]                  1       Gm26206-201           ensembl              snRNA\n#&gt;   [6]                  1       Gm26206-201           ensembl              snRNA\n#&gt;        havana_transcript havana_transcript_version         tag\n#&gt;              &lt;character&gt;               &lt;character&gt; &lt;character&gt;\n#&gt;   [1]               &lt;NA&gt;                      &lt;NA&gt;        &lt;NA&gt;\n#&gt;   [2] OTTMUST00000127109                         1       basic\n#&gt;   [3] OTTMUST00000127109                         1       basic\n#&gt;   [4]               &lt;NA&gt;                      &lt;NA&gt;        &lt;NA&gt;\n#&gt;   [5]               &lt;NA&gt;                      &lt;NA&gt;       basic\n#&gt;   [6]               &lt;NA&gt;                      &lt;NA&gt;       basic\n#&gt;       transcript_support_level exon_number            exon_id exon_version\n#&gt;                    &lt;character&gt; &lt;character&gt;        &lt;character&gt;  &lt;character&gt;\n#&gt;   [1]                     &lt;NA&gt;        &lt;NA&gt;               &lt;NA&gt;         &lt;NA&gt;\n#&gt;   [2]                       NA        &lt;NA&gt;               &lt;NA&gt;         &lt;NA&gt;\n#&gt;   [3]                       NA           1 ENSMUSE00001343744            1\n#&gt;   [4]                     &lt;NA&gt;        &lt;NA&gt;               &lt;NA&gt;         &lt;NA&gt;\n#&gt;   [5]                       NA        &lt;NA&gt;               &lt;NA&gt;         &lt;NA&gt;\n#&gt;   [6]                       NA           1 ENSMUSE00000522066            1\n#&gt;           ccds_id  protein_id protein_version\n#&gt;       &lt;character&gt; &lt;character&gt;     &lt;character&gt;\n#&gt;   [1]        &lt;NA&gt;        &lt;NA&gt;            &lt;NA&gt;\n#&gt;   [2]        &lt;NA&gt;        &lt;NA&gt;            &lt;NA&gt;\n#&gt;   [3]        &lt;NA&gt;        &lt;NA&gt;            &lt;NA&gt;\n#&gt;   [4]        &lt;NA&gt;        &lt;NA&gt;            &lt;NA&gt;\n#&gt;   [5]        &lt;NA&gt;        &lt;NA&gt;            &lt;NA&gt;\n#&gt;   [6]        &lt;NA&gt;        &lt;NA&gt;            &lt;NA&gt;\n#&gt;   -------\n#&gt;   seqinfo: 45 sequences from an unspecified genome; no seqlengths\n\n# 整理数据\ngene.data &lt;- gene.data[gene.data$type==\"gene\"]\nnames(gene.data) &lt;- gene.data$gene_id\n\n#DataFrame：mcols(gene.data) \nis.gene.related &lt;- str_detect(colnames(mcols(gene.data)),\"gene_\") #  6 TRUE\nmcols(gene.data) &lt;- mcols(gene.data)[,is.gene.related]\nmcols(gene.data)  # 46603 × 6\n#&gt; DataFrame with 46603 rows and 6 columns\n#&gt;                               gene_id gene_version      gene_name\n#&gt;                           &lt;character&gt;  &lt;character&gt;    &lt;character&gt;\n#&gt; ENSMUSG00000102693 ENSMUSG00000102693            1  4933401J01Rik\n#&gt; ENSMUSG00000064842 ENSMUSG00000064842            1        Gm26206\n#&gt; ENSMUSG00000051951 ENSMUSG00000051951            5           Xkr4\n#&gt; ENSMUSG00000102851 ENSMUSG00000102851            1        Gm18956\n#&gt; ENSMUSG00000103377 ENSMUSG00000103377            1        Gm37180\n#&gt; ...                               ...          ...            ...\n#&gt; ENSMUSG00000094431 ENSMUSG00000094431            1 CAAA01205117.1\n#&gt; ENSMUSG00000094621 ENSMUSG00000094621            1 CAAA01098150.1\n#&gt; ENSMUSG00000098647 ENSMUSG00000098647            1 CAAA01064564.1\n#&gt; ENSMUSG00000096730 ENSMUSG00000096730            6       Vmn2r122\n#&gt; ENSMUSG00000095742 ENSMUSG00000095742            1 CAAA01147332.1\n#&gt;                       gene_source         gene_biotype havana_gene_version\n#&gt;                       &lt;character&gt;          &lt;character&gt;         &lt;character&gt;\n#&gt; ENSMUSG00000102693         havana                  TEC                   1\n#&gt; ENSMUSG00000064842        ensembl                snRNA                  NA\n#&gt; ENSMUSG00000051951 ensembl_havana       protein_coding                   2\n#&gt; ENSMUSG00000102851         havana processed_pseudogene                   1\n#&gt; ENSMUSG00000103377         havana                  TEC                   1\n#&gt; ...                           ...                  ...                 ...\n#&gt; ENSMUSG00000094431        ensembl                miRNA                  NA\n#&gt; ENSMUSG00000094621        ensembl                miRNA                  NA\n#&gt; ENSMUSG00000098647        ensembl                miRNA                  NA\n#&gt; ENSMUSG00000096730        ensembl       protein_coding                  NA\n#&gt; ENSMUSG00000095742        ensembl       protein_coding                  NA\n\n#rownames(sce) 46603行 观测基因\nSummarizedExperiment::rowRanges(sce) &lt;- gene.data[rownames(sce)]\nSummarizedExperiment::rowRanges(sce)[1:10,]\n#&gt; GRanges object with 10 ranges and 6 metadata columns:\n#&gt;                      seqnames          ranges strand |            gene_id\n#&gt;                         &lt;Rle&gt;       &lt;IRanges&gt;  &lt;Rle&gt; |        &lt;character&gt;\n#&gt;   ENSMUSG00000102693        1 3073253-3074322      + | ENSMUSG00000102693\n#&gt;   ENSMUSG00000064842        1 3102016-3102125      + | ENSMUSG00000064842\n#&gt;   ENSMUSG00000051951        1 3205901-3671498      - | ENSMUSG00000051951\n#&gt;   ENSMUSG00000102851        1 3252757-3253236      + | ENSMUSG00000102851\n#&gt;   ENSMUSG00000103377        1 3365731-3368549      - | ENSMUSG00000103377\n#&gt;   ENSMUSG00000104017        1 3375556-3377788      - | ENSMUSG00000104017\n#&gt;   ENSMUSG00000103025        1 3464977-3467285      - | ENSMUSG00000103025\n#&gt;   ENSMUSG00000089699        1 3466587-3513553      + | ENSMUSG00000089699\n#&gt;   ENSMUSG00000103201        1 3512451-3514507      - | ENSMUSG00000103201\n#&gt;   ENSMUSG00000103147        1 3531795-3532720      + | ENSMUSG00000103147\n#&gt;                      gene_version     gene_name    gene_source\n#&gt;                       &lt;character&gt;   &lt;character&gt;    &lt;character&gt;\n#&gt;   ENSMUSG00000102693            1 4933401J01Rik         havana\n#&gt;   ENSMUSG00000064842            1       Gm26206        ensembl\n#&gt;   ENSMUSG00000051951            5          Xkr4 ensembl_havana\n#&gt;   ENSMUSG00000102851            1       Gm18956         havana\n#&gt;   ENSMUSG00000103377            1       Gm37180         havana\n#&gt;   ENSMUSG00000104017            1       Gm37363         havana\n#&gt;   ENSMUSG00000103025            1       Gm37686         havana\n#&gt;   ENSMUSG00000089699            1        Gm1992         havana\n#&gt;   ENSMUSG00000103201            1       Gm37329         havana\n#&gt;   ENSMUSG00000103147            1        Gm7341         havana\n#&gt;                              gene_biotype havana_gene_version\n#&gt;                               &lt;character&gt;         &lt;character&gt;\n#&gt;   ENSMUSG00000102693                  TEC                   1\n#&gt;   ENSMUSG00000064842                snRNA                &lt;NA&gt;\n#&gt;   ENSMUSG00000051951       protein_coding                   2\n#&gt;   ENSMUSG00000102851 processed_pseudogene                   1\n#&gt;   ENSMUSG00000103377                  TEC                   1\n#&gt;   ENSMUSG00000104017                  TEC                   1\n#&gt;   ENSMUSG00000103025                  TEC                   1\n#&gt;   ENSMUSG00000089699            antisense                   1\n#&gt;   ENSMUSG00000103201                  TEC                   1\n#&gt;   ENSMUSG00000103147 processed_pseudogene                   1\n#&gt;   -------\n#&gt;   seqinfo: 45 sequences from an unspecified genome; no seqlengths\n\nsce\n#&gt; class: SingleCellExperiment \n#&gt; dim: 46603 96 \n#&gt; metadata(0):\n#&gt; assays(1): counts\n#&gt; rownames(46603): ENSMUSG00000102693 ENSMUSG00000064842 ...\n#&gt;   ENSMUSG00000096730 ENSMUSG00000095742\n#&gt; rowData names(6): gene_id gene_version ... gene_biotype\n#&gt;   havana_gene_version\n#&gt; colnames(96): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...\n#&gt;   SLX-9555.N712_S508.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N712_S517.C89V9ANXX.s_1.r_1\n#&gt; colData names(4): phenotype sum detected total\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\n\n\n\n2.3.4 其他元数据metadata\n\n一些分析包含不适合上述 slot 的结果或注释，例如研究元数据。 这可以存储在metadata slot中，这是任意对象的命名列表。 例如，假设有一些favorite_genes（例如，高度可变的基因），我们想将它们存储在其中，以便以后用于我们的分析。 我们只需将以下内容附加到元数据槽即可。\n\nCodemy_genes &lt;- c(\"gene_1\", \"gene_5\")\nmetadata(sce) &lt;- list(favorite_genes = my_genes)\nmetadata(sce)\n#&gt; $favorite_genes\n#&gt; [1] \"gene_1\" \"gene_5\"\nyour_genes &lt;- c(\"gene_4\", \"gene_8\")\nmetadata(sce)$your_genes &lt;- your_genes\nmetadata(sce)\n#&gt; $favorite_genes\n#&gt; [1] \"gene_1\" \"gene_5\"\n#&gt; \n#&gt; $your_genes\n#&gt; [1] \"gene_4\" \"gene_8\"\nsce\n#&gt; class: SingleCellExperiment \n#&gt; dim: 46603 96 \n#&gt; metadata(2): favorite_genes your_genes\n#&gt; assays(1): counts\n#&gt; rownames(46603): ENSMUSG00000102693 ENSMUSG00000064842 ...\n#&gt;   ENSMUSG00000096730 ENSMUSG00000095742\n#&gt; rowData names(6): gene_id gene_version ... gene_biotype\n#&gt;   havana_gene_version\n#&gt; colnames(96): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...\n#&gt;   SLX-9555.N712_S508.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N712_S517.C89V9ANXX.s_1.r_1\n#&gt; colData names(4): phenotype sum detected total\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\n\n\n将内容存储在 metadata 中的主要缺点是，当取子集或组合时，它不会与行或列同步。"
  },
  {
    "objectID": "SCE.html#子集和组合",
    "href": "SCE.html#子集和组合",
    "title": "2  SingleCellExperiment结构",
    "section": "\n2.4 子集和组合",
    "text": "2.4 子集和组合\n\n2.4.1 子集\n\nCodefirst.10 &lt;- sce[,1:10]\nncol(counts(first.10)) #  计数矩阵仅有 10 列\n#&gt; [1] 10\ncolData(first.10) # only 10 rows.\n#&gt; DataFrame with 10 rows and 4 columns\n#&gt;                                                   phenotype       sum  detected\n#&gt;                                                 &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt;\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1    wild type phenotype    854171      7617\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1    wild type phenotype   1044243      7520\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1    wild type phenotype   1152450      8305\n#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   1193876      8142\n#&gt; SLX-9555.N701_S506.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   1521472      7153\n#&gt; SLX-9555.N701_S507.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..    866705      6828\n#&gt; SLX-9555.N701_S508.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..    608581      6966\n#&gt; SLX-9555.N701_S517.C89V9ANXX.s_1.r_1    wild type phenotype   1113526      8634\n#&gt; SLX-9555.N702_S502.C89V9ANXX.s_1.r_1    wild type phenotype   1308250      8364\n#&gt; SLX-9555.N702_S503.C89V9ANXX.s_1.r_1    wild type phenotype    778605      8665\n#&gt;                                          total\n#&gt;                                      &lt;numeric&gt;\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1    854171\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1   1044243\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1   1152450\n#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1   1193876\n#&gt; SLX-9555.N701_S506.C89V9ANXX.s_1.r_1   1521472\n#&gt; SLX-9555.N701_S507.C89V9ANXX.s_1.r_1    866705\n#&gt; SLX-9555.N701_S508.C89V9ANXX.s_1.r_1    608581\n#&gt; SLX-9555.N701_S517.C89V9ANXX.s_1.r_1   1113526\n#&gt; SLX-9555.N702_S502.C89V9ANXX.s_1.r_1   1308250\n#&gt; SLX-9555.N702_S503.C89V9ANXX.s_1.r_1    778605\n\n\n只想要野生型细胞\n\nCodewt.only &lt;- sce[, sce$phenotype == \"wild type phenotype\"]\nncol(counts(wt.only))\n#&gt; [1] 48\ncolData(wt.only)\n#&gt; DataFrame with 48 rows and 4 columns\n#&gt;                                                phenotype       sum  detected\n#&gt;                                              &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt;\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1 wild type phenotype    854171      7617\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 wild type phenotype   1044243      7520\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1 wild type phenotype   1152450      8305\n#&gt; SLX-9555.N701_S517.C89V9ANXX.s_1.r_1 wild type phenotype   1113526      8634\n#&gt; SLX-9555.N702_S502.C89V9ANXX.s_1.r_1 wild type phenotype   1308250      8364\n#&gt; ...                                                  ...       ...       ...\n#&gt; SLX-9555.N711_S517.C89V9ANXX.s_1.r_1 wild type phenotype   1317671      8581\n#&gt; SLX-9555.N712_S502.C89V9ANXX.s_1.r_1 wild type phenotype   1736189      9687\n#&gt; SLX-9555.N712_S503.C89V9ANXX.s_1.r_1 wild type phenotype   1521132      8983\n#&gt; SLX-9555.N712_S504.C89V9ANXX.s_1.r_1 wild type phenotype   1759166      8480\n#&gt; SLX-9555.N712_S517.C89V9ANXX.s_1.r_1 wild type phenotype   1436899      8469\n#&gt;                                          total\n#&gt;                                      &lt;numeric&gt;\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1    854171\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1   1044243\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1   1152450\n#&gt; SLX-9555.N701_S517.C89V9ANXX.s_1.r_1   1113526\n#&gt; SLX-9555.N702_S502.C89V9ANXX.s_1.r_1   1308250\n#&gt; ...                                        ...\n#&gt; SLX-9555.N711_S517.C89V9ANXX.s_1.r_1   1317671\n#&gt; SLX-9555.N712_S502.C89V9ANXX.s_1.r_1   1736189\n#&gt; SLX-9555.N712_S503.C89V9ANXX.s_1.r_1   1521132\n#&gt; SLX-9555.N712_S504.C89V9ANXX.s_1.r_1   1759166\n#&gt; SLX-9555.N712_S517.C89V9ANXX.s_1.r_1   1436899\n\n\n只想保留蛋白质编码基因\n\nCodecoding.only &lt;- sce[rowData(sce)$gene_biotype == \"protein_coding\",]\nnrow(counts(coding.only))\n#&gt; [1] 22013\nrowData(coding.only)\n#&gt; DataFrame with 22013 rows and 6 columns\n#&gt;                               gene_id gene_version      gene_name\n#&gt;                           &lt;character&gt;  &lt;character&gt;    &lt;character&gt;\n#&gt; ENSMUSG00000051951 ENSMUSG00000051951            5           Xkr4\n#&gt; ENSMUSG00000025900 ENSMUSG00000025900            9            Rp1\n#&gt; ENSMUSG00000025902 ENSMUSG00000025902           12          Sox17\n#&gt; ENSMUSG00000033845 ENSMUSG00000033845           12         Mrpl15\n#&gt; ENSMUSG00000025903 ENSMUSG00000025903           13         Lypla1\n#&gt; ...                               ...          ...            ...\n#&gt; ENSMUSG00000079808 ENSMUSG00000079808            3     AC168977.1\n#&gt; ENSMUSG00000095041 ENSMUSG00000095041            6           PISD\n#&gt; ENSMUSG00000063897 ENSMUSG00000063897            3          DHRSX\n#&gt; ENSMUSG00000096730 ENSMUSG00000096730            6       Vmn2r122\n#&gt; ENSMUSG00000095742 ENSMUSG00000095742            1 CAAA01147332.1\n#&gt;                       gene_source   gene_biotype havana_gene_version\n#&gt;                       &lt;character&gt;    &lt;character&gt;         &lt;character&gt;\n#&gt; ENSMUSG00000051951 ensembl_havana protein_coding                   2\n#&gt; ENSMUSG00000025900 ensembl_havana protein_coding                   2\n#&gt; ENSMUSG00000025902 ensembl_havana protein_coding                   6\n#&gt; ENSMUSG00000033845 ensembl_havana protein_coding                   3\n#&gt; ENSMUSG00000025903 ensembl_havana protein_coding                   3\n#&gt; ...                           ...            ...                 ...\n#&gt; ENSMUSG00000079808        ensembl protein_coding                  NA\n#&gt; ENSMUSG00000095041        ensembl protein_coding                  NA\n#&gt; ENSMUSG00000063897        ensembl protein_coding                  NA\n#&gt; ENSMUSG00000096730        ensembl protein_coding                  NA\n#&gt; ENSMUSG00000095742        ensembl protein_coding                  NA\n\n\n\n2.4.2 组合\n按列组合，假设所有涉及的对象都具有相同的行注释值和兼容的列注释字段\n\nCodesce2 &lt;- cbind(sce, sce)\nncol(counts(sce2)) # twice as many columns\n#&gt; [1] 192\ncolData(sce2) # twice as many rows\n#&gt; DataFrame with 192 rows and 4 columns\n#&gt;                                                   phenotype       sum  detected\n#&gt;                                                 &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt;\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1    wild type phenotype    854171      7617\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1    wild type phenotype   1044243      7520\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1    wild type phenotype   1152450      8305\n#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   1193876      8142\n#&gt; SLX-9555.N701_S506.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   1521472      7153\n#&gt; ...                                                     ...       ...       ...\n#&gt; SLX-9555.N712_S505.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..    203221      5608\n#&gt; SLX-9555.N712_S506.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   1059853      6948\n#&gt; SLX-9555.N712_S507.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   1672343      6879\n#&gt; SLX-9555.N712_S508.C89V9ANXX.s_1.r_1 induced CBFB-MYH11 o..   1939537      7213\n#&gt; SLX-9555.N712_S517.C89V9ANXX.s_1.r_1    wild type phenotype   1436899      8469\n#&gt;                                          total\n#&gt;                                      &lt;numeric&gt;\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1    854171\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1   1044243\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1   1152450\n#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1   1193876\n#&gt; SLX-9555.N701_S506.C89V9ANXX.s_1.r_1   1521472\n#&gt; ...                                        ...\n#&gt; SLX-9555.N712_S505.C89V9ANXX.s_1.r_1    203221\n#&gt; SLX-9555.N712_S506.C89V9ANXX.s_1.r_1   1059853\n#&gt; SLX-9555.N712_S507.C89V9ANXX.s_1.r_1   1672343\n#&gt; SLX-9555.N712_S508.C89V9ANXX.s_1.r_1   1939537\n#&gt; SLX-9555.N712_S517.C89V9ANXX.s_1.r_1   1436899\n\n\n按行组合，假设所有对象都具有相同的列注释值和兼容的行注释字段。\n\nCodesce2 &lt;- rbind(sce, sce)\nnrow(counts(sce2)) # twice as many rows\n#&gt; [1] 93206\nrowData(sce2) # twice as many rows\n#&gt; DataFrame with 93206 rows and 6 columns\n#&gt;                               gene_id gene_version      gene_name\n#&gt;                           &lt;character&gt;  &lt;character&gt;    &lt;character&gt;\n#&gt; ENSMUSG00000102693 ENSMUSG00000102693            1  4933401J01Rik\n#&gt; ENSMUSG00000064842 ENSMUSG00000064842            1        Gm26206\n#&gt; ENSMUSG00000051951 ENSMUSG00000051951            5           Xkr4\n#&gt; ENSMUSG00000102851 ENSMUSG00000102851            1        Gm18956\n#&gt; ENSMUSG00000103377 ENSMUSG00000103377            1        Gm37180\n#&gt; ...                               ...          ...            ...\n#&gt; ENSMUSG00000094431 ENSMUSG00000094431            1 CAAA01205117.1\n#&gt; ENSMUSG00000094621 ENSMUSG00000094621            1 CAAA01098150.1\n#&gt; ENSMUSG00000098647 ENSMUSG00000098647            1 CAAA01064564.1\n#&gt; ENSMUSG00000096730 ENSMUSG00000096730            6       Vmn2r122\n#&gt; ENSMUSG00000095742 ENSMUSG00000095742            1 CAAA01147332.1\n#&gt;                       gene_source         gene_biotype havana_gene_version\n#&gt;                       &lt;character&gt;          &lt;character&gt;         &lt;character&gt;\n#&gt; ENSMUSG00000102693         havana                  TEC                   1\n#&gt; ENSMUSG00000064842        ensembl                snRNA                  NA\n#&gt; ENSMUSG00000051951 ensembl_havana       protein_coding                   2\n#&gt; ENSMUSG00000102851         havana processed_pseudogene                   1\n#&gt; ENSMUSG00000103377         havana                  TEC                   1\n#&gt; ...                           ...                  ...                 ...\n#&gt; ENSMUSG00000094431        ensembl                miRNA                  NA\n#&gt; ENSMUSG00000094621        ensembl                miRNA                  NA\n#&gt; ENSMUSG00000098647        ensembl                miRNA                  NA\n#&gt; ENSMUSG00000096730        ensembl       protein_coding                  NA\n#&gt; ENSMUSG00000095742        ensembl       protein_coding                  NA"
  },
  {
    "objectID": "SCE.html#单细胞特异性字段",
    "href": "SCE.html#单细胞特异性字段",
    "title": "2  SingleCellExperiment结构",
    "section": "\n2.5 单细胞特异性字段",
    "text": "2.5 单细胞特异性字段\n\n2.5.1 降维 reducedDims\n\n使用 scater中的函数计算 PCA 、t-SNE\n\nPCAsce\n#&gt; class: SingleCellExperiment \n#&gt; dim: 46603 96 \n#&gt; metadata(2): favorite_genes your_genes\n#&gt; assays(1): counts\n#&gt; rownames(46603): ENSMUSG00000102693 ENSMUSG00000064842 ...\n#&gt;   ENSMUSG00000096730 ENSMUSG00000095742\n#&gt; rowData names(6): gene_id gene_version ... gene_biotype\n#&gt;   havana_gene_version\n#&gt; colnames(96): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...\n#&gt;   SLX-9555.N712_S508.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N712_S517.C89V9ANXX.s_1.r_1\n#&gt; colData names(4): phenotype sum detected total\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\nsce &lt;- scater::logNormCounts(sce)\nsce &lt;- scater::runPCA(sce)\ndim(reducedDim(sce, \"PCA\"))\n#&gt; [1] 96 50\n\n\n\nTSNEsce &lt;- scater::runTSNE(sce, perplexity = 0.1)\n#&gt; Perplexity should be lower than K!\nhead(reducedDim(sce, \"TSNE\"))\n#&gt;                                           TSNE1      TSNE2\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1  221.56801 -561.81044\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1  292.45974 1163.50864\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1 1218.11525  137.37753\n#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1   76.19598   73.34854\n#&gt; SLX-9555.N701_S506.C89V9ANXX.s_1.r_1 -818.33258  602.14273\n#&gt; SLX-9555.N701_S507.C89V9ANXX.s_1.r_1 -144.59475  156.57061\n\n\n\nUMAPsce &lt;- scater::runUMAP(sce)\nhead(reducedDim(sce,\"UMAP\"))\n#&gt;                                          UMAP1     UMAP2\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1 -3.940352  4.499081\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 -2.636030  4.084418\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1 -3.742099  4.501594\n#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1 -2.990044  6.642652\n#&gt; SLX-9555.N701_S506.C89V9ANXX.s_1.r_1  4.689399 -6.079113\n#&gt; SLX-9555.N701_S507.C89V9ANXX.s_1.r_1  4.926637 -6.416267\n\n\n\n手动UMAPu &lt;- uwot::umap(t(logcounts(sce)), n_neighbors = 2)\nreducedDim(sce, \"UMAP_uwot\") &lt;- u\nreducedDims(sce) # Now stored in the object.\n#&gt; List of length 4\n#&gt; names(4): PCA TSNE UMAP UMAP_uwot\nhead(reducedDim(sce, \"UMAP_uwot\"))\n#&gt;                                            [,1]       [,2]\n#&gt; SLX-9555.N701_S502.C89V9ANXX.s_1.r_1 -3.3690816  0.7263666\n#&gt; SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 -6.0506719  0.7014704\n#&gt; SLX-9555.N701_S504.C89V9ANXX.s_1.r_1 -4.6543006 -0.1315343\n#&gt; SLX-9555.N701_S505.C89V9ANXX.s_1.r_1 -5.8388084  4.2178849\n#&gt; SLX-9555.N701_S506.C89V9ANXX.s_1.r_1  0.4606667 -7.3649853\n#&gt; SLX-9555.N701_S507.C89V9ANXX.s_1.r_1 -1.2466793 -5.2777780\n\n\n\nreduceDims()reducedDims(sce) \n#&gt; List of length 4\n#&gt; names(4): PCA TSNE UMAP UMAP_uwot\n\n\n\n2.5.2 替代试验 Alternative Experiments\n该类SingleCellExperiment提供了”替代实验”的概念，其是一组不同特征但同一组样本/细胞的数据。经典应用是存储加标转录物spike-in transcripts的每细胞计数;这使我们能够保留这些数据以供下游使用，但要将其与保存的内源性基因计数分离。 分离尤为重要，因为此类替代特征通常需要单独处理。\n\nCodedf &lt;- read_tsv(\"data/counts_Calero_20160113.tsv\")\nspike.df &lt;- df[str_detect(df$GeneID,\"^ERCC-\"),] #正则表达式，查询外源RNA\nspike.mat&lt;- as.matrix(spike.df[,-1]) \nrow.names(spike.mat)&lt;-spike.df$GeneID\n\n\n如果我们有一些加标转录本的数据，我们首先创建一个单独的对象SummarizedExperiment\n\nCodespike_se &lt;- SummarizedExperiment(list(counts=spike.mat[,-1]))\nspike_se\n#&gt; class: SummarizedExperiment \n#&gt; dim: 92 96 \n#&gt; metadata(0):\n#&gt; assays(1): counts\n#&gt; rownames(92): ERCC-00002 ERCC-00003 ... ERCC-00170 ERCC-00171\n#&gt; rowData names(0):\n#&gt; colnames(96): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...\n#&gt;   SLX-9555.N712_S508.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N712_S517.C89V9ANXX.s_1.r_1\n#&gt; colData names(0):\n\n\n\nCodealtExp(sce, \"spike\") &lt;- spike_se\n\naltExps(sce) #检索\n#&gt; List of length 1\n#&gt; names(1): spike\n\n\n替代实验概念确保单细胞数据集的所有相关方面都可以保存在单个对象中，并且确保我们的加标数据与内源性基因的数据同步。\n\nCodesub &lt;- sce[,1:2] # retain only two samples.\naltExp(sub, \"spike\")\n#&gt; class: SummarizedExperiment \n#&gt; dim: 92 2 \n#&gt; metadata(0):\n#&gt; assays(1): counts\n#&gt; rownames(92): ERCC-00002 ERCC-00003 ... ERCC-00170 ERCC-00171\n#&gt; rowData names(0):\n#&gt; colnames(2): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1\n#&gt; colData names(0):\n\n\n任何SummarizedExperiment对象都可以存储为alternative Experiment, 包括另一个 SingleCellExperiment。\n\n2.5.3 缩放因子sizeFactors\n\n\nCodesce &lt;- scran::computeSumFactors(sce)\nsummary(sizeFactors(sce))\n#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#&gt;  0.1513  0.7417  0.9478  1.0000  1.1239  3.5583\n\n\n手动添加\n\nCodesizeFactors(sce) &lt;- scater::librarySizeFactors(sce)\nsummary(sizeFactors(sce))\n#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#&gt;  0.1703  0.7657  0.9513  1.0000  1.1064  3.6050\n\n\n\n2.5.4 列标签\n该函数允许我们获取或设置每个细胞标签的向量或因子，通常对应于由无监督聚类分析的分组（ sec-basics第5章）。 或从分类算法预测细胞类型身份 （ sec-basics第7章）\n\nCodecolLabels(sce) &lt;- scran::clusterCells(sce, use.dimred=\"PCA\")\ntable(colLabels(sce))\n#&gt; \n#&gt;  1  2 \n#&gt; 47 49"
  },
  {
    "objectID": "analysis.html#outline",
    "href": "analysis.html#outline",
    "title": "\n3  分析概述\n",
    "section": "\n3.1 outline",
    "text": "3.1 outline\n本章概述了典型scRNA-seq分析工作流程的框架（图 3.1）\n\n\n图 3.1: 典型 scRNA-seq 分析工作流程示意图。每个阶段（用虚线分隔）由许多特定步骤组成，其中许多步骤对实例进行操作和修改"
  },
  {
    "objectID": "analysis.html#快速入门简单",
    "href": "analysis.html#快速入门简单",
    "title": "\n3  分析概述\n",
    "section": "\n3.2 快速入门（简单）",
    "text": "3.2 快速入门（简单）\n原书使用来自Macosko等人（2015）的基于液滴的视网膜数据集，该数据集在scRNAseq包中提供。\n从计数矩阵开始，以聚类结束( 图 3.1 )。\n\n数据集信息library(scRNAseq)\nsce &lt;- MacoskoRetinaData()\nsce\n#&gt; class: SingleCellExperiment \n#&gt; dim: 24658 49300 \n#&gt; metadata(0):\n#&gt; assays(1): counts\n#&gt; rownames(24658): KITL TMTC3 ... 1110059M19RIK GM20861\n#&gt; rowData names(0):\n#&gt; colnames(49300): r1_GGCCGCAGTCCG r1_CTTGTGCGGGAA ... p1_TAACGCGCTCCT\n#&gt;   p1_ATTCTTGTTCTT\n#&gt; colData names(2): cell.id cluster\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\ncounts &lt;- assay(sce, \"counts\")\ncolData(sce)\n#&gt; DataFrame with 49300 rows and 2 columns\n#&gt;                         cell.id   cluster\n#&gt;                     &lt;character&gt; &lt;integer&gt;\n#&gt; r1_GGCCGCAGTCCG r1_GGCCGCAGTCCG         2\n#&gt; r1_CTTGTGCGGGAA r1_CTTGTGCGGGAA         2\n#&gt; r1_GCGCAACTGCTC r1_GCGCAACTGCTC         2\n#&gt; r1_GATTGGGAGGCA r1_GATTGGGAGGCA         2\n#&gt; r1_CCTCCTAGTTGG r1_CCTCCTAGTTGG        NA\n#&gt; ...                         ...       ...\n#&gt; p1_TCAAAAGCCGGG p1_TCAAAAGCCGGG        24\n#&gt; p1_ATTAAGTTCCAA p1_ATTAAGTTCCAA        34\n#&gt; p1_CTGTCTGAGACC p1_CTGTCTGAGACC         2\n#&gt; p1_TAACGCGCTCCT p1_TAACGCGCTCCT        24\n#&gt; p1_ATTCTTGTTCTT p1_ATTCTTGTTCTT        24\n\n\n\n质量控制# Quality control (using mitochondrial genes)线粒体基因\nlibrary(scater)\nis.mito &lt;- str_detect(rownames(sce),\"^MT-\") \nsum(is.mito) # 31个\n#&gt; [1] 31\n\n#?perCellQCMetrics\nperCellQCMetrics(sce)\n#&gt; DataFrame with 49300 rows and 3 columns\n#&gt;                       sum  detected     total\n#&gt;                 &lt;numeric&gt; &lt;integer&gt; &lt;numeric&gt;\n#&gt; r1_GGCCGCAGTCCG     37487      7243     37487\n#&gt; r1_CTTGTGCGGGAA     32047      6933     32047\n#&gt; r1_GCGCAACTGCTC     28148      6397     28148\n#&gt; r1_GATTGGGAGGCA     20367      5740     20367\n#&gt; r1_CCTCCTAGTTGG     19560      5779     19560\n#&gt; ...                   ...       ...       ...\n#&gt; p1_TCAAAAGCCGGG       817       537       817\n#&gt; p1_ATTAAGTTCCAA       817       574       817\n#&gt; p1_CTGTCTGAGACC       817       637       817\n#&gt; p1_TAACGCGCTCCT       816       488       816\n#&gt; p1_ATTCTTGTTCTT       816       484       816\nqcstats &lt;- perCellQCMetrics(sce, subsets=list(Mito=is.mito))\nqcstats\n#&gt; DataFrame with 49300 rows and 6 columns\n#&gt;                       sum  detected subsets_Mito_sum subsets_Mito_detected\n#&gt;                 &lt;numeric&gt; &lt;integer&gt;        &lt;numeric&gt;             &lt;integer&gt;\n#&gt; r1_GGCCGCAGTCCG     37487      7243              427                    14\n#&gt; r1_CTTGTGCGGGAA     32047      6933              503                    15\n#&gt; r1_GCGCAACTGCTC     28148      6397              460                    13\n#&gt; r1_GATTGGGAGGCA     20367      5740              326                    11\n#&gt; r1_CCTCCTAGTTGG     19560      5779              264                     9\n#&gt; ...                   ...       ...              ...                   ...\n#&gt; p1_TCAAAAGCCGGG       817       537               13                     4\n#&gt; p1_ATTAAGTTCCAA       817       574               10                     5\n#&gt; p1_CTGTCTGAGACC       817       637               24                     7\n#&gt; p1_TAACGCGCTCCT       816       488               27                     5\n#&gt; p1_ATTCTTGTTCTT       816       484               16                     4\n#&gt;                 subsets_Mito_percent     total\n#&gt;                            &lt;numeric&gt; &lt;numeric&gt;\n#&gt; r1_GGCCGCAGTCCG              1.13906     37487\n#&gt; r1_CTTGTGCGGGAA              1.56957     32047\n#&gt; r1_GCGCAACTGCTC              1.63422     28148\n#&gt; r1_GATTGGGAGGCA              1.60063     20367\n#&gt; r1_CCTCCTAGTTGG              1.34969     19560\n#&gt; ...                              ...       ...\n#&gt; p1_TCAAAAGCCGGG              1.59119       817\n#&gt; p1_ATTAAGTTCCAA              1.22399       817\n#&gt; p1_CTGTCTGAGACC              2.93758       817\n#&gt; p1_TAACGCGCTCCT              3.30882       816\n#&gt; p1_ATTCTTGTTCTT              1.96078       816\n\n#?quickPerCellQC\nquickPerCellQC(sce) |&gt; colData()\n#&gt; DataFrame with 49287 rows and 8 columns\n#&gt;                         cell.id   cluster       sum  detected     total\n#&gt;                     &lt;character&gt; &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt; &lt;numeric&gt;\n#&gt; r1_GGCCGCAGTCCG r1_GGCCGCAGTCCG         2     37487      7243     37487\n#&gt; r1_CTTGTGCGGGAA r1_CTTGTGCGGGAA         2     32047      6933     32047\n#&gt; r1_GCGCAACTGCTC r1_GCGCAACTGCTC         2     28148      6397     28148\n#&gt; r1_GATTGGGAGGCA r1_GATTGGGAGGCA         2     20367      5740     20367\n#&gt; r1_CCTCCTAGTTGG r1_CCTCCTAGTTGG        NA     19560      5779     19560\n#&gt; ...                         ...       ...       ...       ...       ...\n#&gt; p1_TCAAAAGCCGGG p1_TCAAAAGCCGGG        24       817       537       817\n#&gt; p1_ATTAAGTTCCAA p1_ATTAAGTTCCAA        34       817       574       817\n#&gt; p1_CTGTCTGAGACC p1_CTGTCTGAGACC         2       817       637       817\n#&gt; p1_TAACGCGCTCCT p1_TAACGCGCTCCT        24       816       488       816\n#&gt; p1_ATTCTTGTTCTT p1_ATTCTTGTTCTT        24       816       484       816\n#&gt;                     low_lib_size   low_n_features   discard\n#&gt;                 &lt;outlier.filter&gt; &lt;outlier.filter&gt; &lt;logical&gt;\n#&gt; r1_GGCCGCAGTCCG            FALSE            FALSE     FALSE\n#&gt; r1_CTTGTGCGGGAA            FALSE            FALSE     FALSE\n#&gt; r1_GCGCAACTGCTC            FALSE            FALSE     FALSE\n#&gt; r1_GATTGGGAGGCA            FALSE            FALSE     FALSE\n#&gt; r1_CCTCCTAGTTGG            FALSE            FALSE     FALSE\n#&gt; ...                          ...              ...       ...\n#&gt; p1_TCAAAAGCCGGG            FALSE            FALSE     FALSE\n#&gt; p1_ATTAAGTTCCAA            FALSE            FALSE     FALSE\n#&gt; p1_CTGTCTGAGACC            FALSE            FALSE     FALSE\n#&gt; p1_TAACGCGCTCCT            FALSE            FALSE     FALSE\n#&gt; p1_ATTCTTGTTCTT            FALSE            FALSE     FALSE\nquickPerCellQC(qcstats)\n#&gt; DataFrame with 49300 rows and 3 columns\n#&gt;           low_lib_size   low_n_features   discard\n#&gt;       &lt;outlier.filter&gt; &lt;outlier.filter&gt; &lt;logical&gt;\n#&gt; 1                FALSE            FALSE     FALSE\n#&gt; 2                FALSE            FALSE     FALSE\n#&gt; 3                FALSE            FALSE     FALSE\n#&gt; 4                FALSE            FALSE     FALSE\n#&gt; 5                FALSE            FALSE     FALSE\n#&gt; ...                ...              ...       ...\n#&gt; 49296            FALSE            FALSE     FALSE\n#&gt; 49297            FALSE            FALSE     FALSE\n#&gt; 49298            FALSE            FALSE     FALSE\n#&gt; 49299            FALSE            FALSE     FALSE\n#&gt; 49300            FALSE            FALSE     FALSE\nfiltered &lt;- quickPerCellQC(qcstats, percent_subsets=\"subsets_Mito_percent\")\nfiltered\n#&gt; DataFrame with 49300 rows and 4 columns\n#&gt;           low_lib_size   low_n_features high_subsets_Mito_percent   discard\n#&gt;       &lt;outlier.filter&gt; &lt;outlier.filter&gt;          &lt;outlier.filter&gt; &lt;logical&gt;\n#&gt; 1                FALSE            FALSE                     FALSE     FALSE\n#&gt; 2                FALSE            FALSE                     FALSE     FALSE\n#&gt; 3                FALSE            FALSE                     FALSE     FALSE\n#&gt; 4                FALSE            FALSE                     FALSE     FALSE\n#&gt; 5                FALSE            FALSE                     FALSE     FALSE\n#&gt; ...                ...              ...                       ...       ...\n#&gt; 49296            FALSE            FALSE                     FALSE     FALSE\n#&gt; 49297            FALSE            FALSE                     FALSE     FALSE\n#&gt; 49298            FALSE            FALSE                     FALSE     FALSE\n#&gt; 49299            FALSE            FALSE                     FALSE     FALSE\n#&gt; 49300            FALSE            FALSE                     FALSE     FALSE\nsce &lt;- sce[, !filtered$discard] # discard 丢弃\nsce\n#&gt; class: SingleCellExperiment \n#&gt; dim: 24658 45877 \n#&gt; metadata(0):\n#&gt; assays(1): counts\n#&gt; rownames(24658): KITL TMTC3 ... 1110059M19RIK GM20861\n#&gt; rowData names(0):\n#&gt; colnames(45877): r1_GGCCGCAGTCCG r1_CTTGTGCGGGAA ... p1_TAACGCGCTCCT\n#&gt;   p1_ATTCTTGTTCTT\n#&gt; colData names(2): cell.id cluster\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: NULL\n#&gt; altExpNames(0):\n\n\n\nNormalizationlibrary(scuttle)\nsce &lt;- logNormCounts(sce)\nassays(sce)\n#&gt; List of length 2\n#&gt; names(2): counts logcounts\n\n\n\nFeature selectionlibrary(scran)\ndec &lt;- modelGeneVar(sce)  # ?modelGeneVar  对每个基因的对数表达谱的方差进行建模，根据拟合的均值-方差趋势将其分解为技术和生物学成分。\ndec\n#&gt; DataFrame with 24658 rows and 6 columns\n#&gt;                      mean       total        tech          bio   p.value\n#&gt;                 &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;    &lt;numeric&gt; &lt;numeric&gt;\n#&gt; KITL           0.00884872 0.011881960 0.011546899  3.35060e-04 0.4118020\n#&gt; TMTC3          0.05143737 0.075214907 0.066708042  8.50687e-03 0.1636316\n#&gt; CEP290         0.57977970 0.841422026 0.689765311  1.51657e-01 0.0456074\n#&gt; 4930430F08RIK  0.05284121 0.069214001 0.068514734  6.99267e-04 0.4687536\n#&gt; 1700017N19RIK  0.00047060 0.000537273 0.000614846 -7.75727e-05 0.8337798\n#&gt; ...                   ...         ...         ...          ...       ...\n#&gt; VSIG1         7.47516e-06 2.56352e-06 9.76708e-06 -7.20357e-06         1\n#&gt; GM16390       0.00000e+00 0.00000e+00 0.00000e+00  0.00000e+00       NaN\n#&gt; GM25207       3.60098e-06 5.94891e-07 4.70506e-06 -4.11017e-06         1\n#&gt; 1110059M19RIK 0.00000e+00 0.00000e+00 0.00000e+00  0.00000e+00       NaN\n#&gt; GM20861       0.00000e+00 0.00000e+00 0.00000e+00  0.00000e+00       NaN\n#&gt;                     FDR\n#&gt;               &lt;numeric&gt;\n#&gt; KITL           1.000000\n#&gt; TMTC3          1.000000\n#&gt; CEP290         0.791672\n#&gt; 4930430F08RIK  1.000000\n#&gt; 1700017N19RIK  1.000000\n#&gt; ...                 ...\n#&gt; VSIG1                 1\n#&gt; GM16390             NaN\n#&gt; GM25207               1\n#&gt; 1110059M19RIK       NaN\n#&gt; GM20861             NaN\nhvg &lt;- getTopHVGs(dec, prop=0.1) # ?getTopHVGs 根据 modelGeneVar() 或相关函数的方差建模统计数据，定义一组高度可变的基因。\nlength(hvg)\n#&gt; [1] 914\n\n\n\n数据降维### PCA\nlibrary(scater)\nset.seed(1234)\nsce &lt;- runPCA(sce, ncomponents=25, subset_row=hvg)\ndim(reducedDim(sce,\"PCA\"))\n#&gt; [1] 45877    25\n\n### Clustering\nlibrary(bluster)\ncolLabels(sce) &lt;- clusterCells(sce, use.dimred='PCA',\n                               BLUSPARAM=NNGraphParam(cluster.fun=\"louvain\"))\ntable(colLabels(sce))\n#&gt; \n#&gt;    1    2    3    4    5    6    7    8    9   10   11   12   13 \n#&gt; 3515 2360  182 4519 1889 2599  193 6501  496 2735 6154 5210 9524\n\n\n\n可视化sce &lt;- runUMAP(sce, dimred = 'PCA')\nplotUMAP(sce, colour_by=\"label\")\n\n\n\n图 3.2: 视网膜数据集的UMAP 图，其中每个点都是一个细胞，并由分配的聚类标识着色。\n\n\n\n\nMarker detectionmarkers &lt;- findMarkers(sce, test.type=\"wilcox\", direction=\"up\", lfc=1)# ?findMarkers 通过检测细胞组配对之间的差异表达，找到细胞组（如聚类）的候选标记基因。"
  },
  {
    "objectID": "analysis.html#快速开始多批次",
    "href": "analysis.html#快速开始多批次",
    "title": "\n3  分析概述\n",
    "section": "\n3.3 快速开始（多批次）",
    "text": "3.3 快速开始（多批次）\n工作流第 8 章中提供了对同一数据集的更详细分析以及每个步骤的理由。\n\nCode\nsce1 &lt;- SegerstolpePancreasData()\n\n# Quality control (using ERCCs).\nqcstats1 &lt;- perCellQCMetrics(sce1)\nfiltered1 &lt;- quickPerCellQC(qcstats1, percent_subsets=\"altexps_ERCC_percent\")\nsce1 &lt;- sce1[, !filtered1$discard]\n\n# Normalization.\nsce1 &lt;- logNormCounts(sce1)\n\n# Feature selection, blocking on the individual of origin.\ndec1 &lt;- modelGeneVar(sce1, block=sce1$individual)\nhvg1 &lt;- getTopHVGs(dec1, prop=0.1)\n\n# Batch correction.\nlibrary(batchelor)\nset.seed(1234)\nsce1 &lt;- correctExperiments(sce1, batch=sce1$individual, \n    subset.row=hvg1, correct.all=TRUE)\n\n# Clustering.\ncolLabels(sce1) &lt;- clusterCells(sce1, use.dimred='corrected')\ntable(colLabels(sce1))\n#&gt; \n#&gt;   1   2   3   4   5   6   7   8   9  10  11  12 \n#&gt; 462  61 138 104 283  70 968 216  36 116  10  22\n\n\n\n可视化sce1 &lt;- runUMAP(sce1, dimred = 'corrected')\nplotUMAP(sce1, colour_by=\"label\")\nplotUMAP(sce1, colour_by=\"individual\")\n\n\n\n\n\n(a) 根据聚类标记\n\n\n\n\n\n(b) 根据起源个体\n\n\n\n图 3.3: 胰腺数据集的 UMAP 图，其中每个点都是一个细胞，并由分配的聚类标识（左）或起源个体（右）着色。\n\n\n\n\nCode# Marker detection, blocking on the individual of origin.\nmarkers1 &lt;- findMarkers(sce1, test.type=\"wilcox\", direction=\"up\", lfc=1)"
  },
  {
    "objectID": "basics.html",
    "href": "basics.html",
    "title": "Basics",
    "section": "",
    "text": "第二部分 Basics"
  },
  {
    "objectID": "QC.html#qc-metrics",
    "href": "QC.html#qc-metrics",
    "title": "\n4  质量控制\n",
    "section": "\n4.1 QC metrics",
    "text": "4.1 QC metrics\n\nThe library size is defined as the total sum of counts across all relevant features for each cell. Cells with small library sizes are of low quality.库大小定义为每个细胞所有基因的计数总和。\nThe number of expressed features in each cell is defined as the number of endogenous genes with non-zero counts for that cell. Any cell with very few expressed genes is likely to be of poor quality. 每个细胞中表达特征的数量被定义为该细胞具有非零计数的内源性基因的数量。\nThe proportion of reads mapped to spike-in transcripts is calculated relative to the total count across all features (including spike-ins) for each cell.High proportions are indicative of poor-quality cells。 相对于每个细胞所有特征（包括加标）的总计数，计算映射到加标转录物中的读数比例。高比例表示细胞质量差\nIn the absence of spike-in transcripts, the proportion of reads mapped to genes in the mitochondrial genome can be used. High proportions are indicative of poor-quality cells。在没有加标转录物的情况下，可以使用映射到线粒体基因组中基因的读数比例。高比例表示细胞质量差。\n\n对于每个细胞，我们使用 scater 包中的函数perCellQCMetrics()计算这些 QC 指标,该列sum包含每个细胞文库大小的总计数，该列detected包含检测到的基因数。 该列subsets_Mito_percent包含映射到线粒体转录本的读取百分比，该列altexps_ERCC_percent包含映射到 ERCC 转录本的读取百分比。\n\nCodesce.416b\n#&gt; class: SingleCellExperiment \n#&gt; dim: 46604 192 \n#&gt; metadata(0):\n#&gt; assays(1): counts\n#&gt; rownames(46604): ENSMUSG00000102693 ENSMUSG00000064842 ...\n#&gt;   ENSMUSG00000095742 CBFB-MYH11-mcherry\n#&gt; rowData names(1): Length\n#&gt; colnames(192): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...\n#&gt;   SLX-11312.N712_S508.H5H5YBBXX.s_8.r_1\n#&gt;   SLX-11312.N712_S517.H5H5YBBXX.s_8.r_1\n#&gt; colData names(9): Source Name cell line ... spike-in addition block\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: endogenous\n#&gt; altExpNames(2): ERCC SIRV\nlocation &lt;- SummarizedExperiment::rowRanges(sce.416b)\nlocation\n#&gt; GRangesList object of length 46604:\n#&gt; $ENSMUSG00000102693\n#&gt; GRanges object with 1 range and 0 metadata columns:\n#&gt;       seqnames          ranges strand\n#&gt;          &lt;Rle&gt;       &lt;IRanges&gt;  &lt;Rle&gt;\n#&gt;   [1]        1 3073253-3074322      +\n#&gt;   -------\n#&gt;   seqinfo: 118 sequences (1 circular) from GRCm38 genome\n#&gt; \n#&gt; $ENSMUSG00000064842\n#&gt; GRanges object with 1 range and 0 metadata columns:\n#&gt;       seqnames          ranges strand\n#&gt;          &lt;Rle&gt;       &lt;IRanges&gt;  &lt;Rle&gt;\n#&gt;   [1]        1 3102016-3102125      +\n#&gt;   -------\n#&gt;   seqinfo: 118 sequences (1 circular) from GRCm38 genome\n#&gt; \n#&gt; $ENSMUSG00000051951\n#&gt; GRanges object with 1 range and 0 metadata columns:\n#&gt;       seqnames          ranges strand\n#&gt;          &lt;Rle&gt;       &lt;IRanges&gt;  &lt;Rle&gt;\n#&gt;   [1]        1 3205901-3671498      -\n#&gt;   -------\n#&gt;   seqinfo: 118 sequences (1 circular) from GRCm38 genome\n#&gt; \n#&gt; ...\n#&gt; &lt;46601 more elements&gt;\nis.mito &lt;- any(seqnames(location)==\"MT\")\n\nlibrary(scuttle)\ndf &lt;- perCellQCMetrics(sce.416b, subsets=list(Mito=is.mito))\ncolnames(df)\n#&gt;  [1] \"sum\"                   \"detected\"              \"subsets_Mito_sum\"     \n#&gt;  [4] \"subsets_Mito_detected\" \"subsets_Mito_percent\"  \"altexps_ERCC_sum\"     \n#&gt;  [7] \"altexps_ERCC_detected\" \"altexps_ERCC_percent\"  \"altexps_SIRV_sum\"     \n#&gt; [10] \"altexps_SIRV_detected\" \"altexps_SIRV_percent\"  \"total\"\nsummary(df$sum)\n#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#&gt;   27084  856350 1111252 1165865 1328301 4398883\nsummary(df$altexps_ERCC_percent)\n#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#&gt;   2.242   4.291   6.031   6.412   8.126  19.429\n\n\n或者 addPerCellQC()计算每个细胞的 QC 统计数据并将其附加到对象的colData 允许我们将所有相关信息保留在单个对象SingleCellExperiment中以供以后操作。\n\nCodesce.416b &lt;- addPerCellQCMetrics(sce.416b, subsets=list(Mito=is.mito))\ndim(colData(sce.416b))\n#&gt; [1] 192  21\ncolnames(colData(sce.416b))\n#&gt;  [1] \"Source Name\"              \"cell line\"               \n#&gt;  [3] \"cell type\"                \"single cell well quality\"\n#&gt;  [5] \"genotype\"                 \"phenotype\"               \n#&gt;  [7] \"strain\"                   \"spike-in addition\"       \n#&gt;  [9] \"block\"                    \"sum\"                     \n#&gt; [11] \"detected\"                 \"subsets_Mito_sum\"        \n#&gt; [13] \"subsets_Mito_detected\"    \"subsets_Mito_percent\"    \n#&gt; [15] \"altexps_ERCC_sum\"         \"altexps_ERCC_detected\"   \n#&gt; [17] \"altexps_ERCC_percent\"     \"altexps_SIRV_sum\"        \n#&gt; [19] \"altexps_SIRV_detected\"    \"altexps_SIRV_percent\"    \n#&gt; [21] \"total\"\nsce.416b\n#&gt; class: SingleCellExperiment \n#&gt; dim: 46604 192 \n#&gt; metadata(0):\n#&gt; assays(1): counts\n#&gt; rownames(46604): ENSMUSG00000102693 ENSMUSG00000064842 ...\n#&gt;   ENSMUSG00000095742 CBFB-MYH11-mcherry\n#&gt; rowData names(1): Length\n#&gt; colnames(192): SLX-9555.N701_S502.C89V9ANXX.s_1.r_1\n#&gt;   SLX-9555.N701_S503.C89V9ANXX.s_1.r_1 ...\n#&gt;   SLX-11312.N712_S508.H5H5YBBXX.s_8.r_1\n#&gt;   SLX-11312.N712_S517.H5H5YBBXX.s_8.r_1\n#&gt; colData names(21): Source Name cell line ... altexps_SIRV_percent total\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: endogenous\n#&gt; altExpNames(2): ERCC SIRV"
  },
  {
    "objectID": "QC.html#识别低质量细胞",
    "href": "QC.html#识别低质量细胞",
    "title": "\n4  质量控制\n",
    "section": "\n4.2 识别低质量细胞",
    "text": "4.2 识别低质量细胞\n\n4.2.1 固定阈值\n识别低质量细胞的最简单方法是对 QC 指标应用固定阈值。 例如，如果细胞的文库大小低于 100,000 次读取;表达少于5,000个基因;峰值比例超过10%;或线粒体比例高于10%，我们可能会认为它们的质量较低。\n\nCodeqc.lib &lt;- df$sum &lt; 1e5\nqc.nexprs &lt;- df$detected &lt; 5e3\nqc.spike &lt;- df$altexps_ERCC_percent &gt; 10\nqc.mito &lt;- df$subsets_Mito_percent &gt; 10\ndiscard &lt;- qc.lib | qc.nexprs | qc.spike | qc.mito\n\n# 汇总\ntibble(LibSize=sum(qc.lib), NExprs=sum(qc.nexprs),\n    SpikeProp=sum(qc.spike), MitoProp=sum(qc.mito), Total=sum(discard))\n\n\n\n\nLibSize\nNExprs\nSpikeProp\nMitoProp\nTotal\n\n\n3\n0\n19\n14\n33\n\n\n\n\n\n\n4.2.2 自适应阈值\n假设大部分数据集由高质量的细胞组成，然后，我们根据所有细胞中每个指标的中位数绝对偏差（median absolute deviation ，MAD）来识别各种QC指标的异常值细胞。默认情况下，如果一个值在”有问题”的方向上距离中位数超过3个MAD，我们将其视为异常值。即此类过滤器将保留 99% 遵循正态分布的非异常值。\n\nCodereasons &lt;- perCellQCFilters(df, \n                            sub.fields=c(\"subsets_Mito_percent\",\n                                         \"altexps_ERCC_percent\"))\n?perCellQCFilters\n\ncolSums(as.matrix(reasons)) # apply(as.matrix(reasons),2,sum)\n#&gt;              low_lib_size            low_n_features high_subsets_Mito_percent \n#&gt;                         4                         0                         2 \n#&gt; high_altexps_ERCC_percent                   discard \n#&gt;                         1                         6\nsummary(reasons$discard)\n#&gt;    Mode   FALSE    TRUE \n#&gt; logical     186       6\nattr(reasons$low_lib_size, \"thresholds\")\n#&gt;    lower   higher \n#&gt; 434082.9      Inf\nattr(reasons$low_n_features, \"thresholds\")\n#&gt;    lower   higher \n#&gt; 5231.468      Inf\n\n\n\n4.2.3 其他方法\n根据每个细胞的 QC 指标识别高维空间中的异常值\n\nCodestats &lt;- cbind(log10(df$sum), log10(df$detected),\n    df$subsets_Mito_percent, df$altexps_ERCC_percent)\n\nlibrary(robustbase)\noutlying &lt;- adjOutlyingness(stats, only.outlyingness = TRUE)\nmulti.outlier &lt;- isOutlier(outlying, type = \"higher\")\nsummary(multi.outlier)\n#&gt;    Mode   FALSE    TRUE \n#&gt; logical     181      11"
  },
  {
    "objectID": "QC.html#检查诊断图",
    "href": "QC.html#检查诊断图",
    "title": "\n4  质量控制\n",
    "section": "\n4.3 检查诊断图",
    "text": "4.3 检查诊断图\n\nCodecolData(sce.416b) &lt;- cbind(colData(sce.416b), df)\n\nsce.416b$block &lt;- factor(sce.416b$block)\nsce.416b$phenotype &lt;- ifelse(grepl(\"induced\", sce.416b$phenotype),\n    \"induced\", \"wild type\")\nsce.416b$discard &lt;- reasons$discard\n\nlibrary(scater)\ngridExtra::grid.arrange(\n    plotColData(sce.416b, x=\"block\", y=\"sum\", colour_by=\"discard\",\n        other_fields=\"phenotype\") + facet_wrap(~phenotype) + \n        scale_y_log10() + ggtitle(\"Total count\"),\n    plotColData(sce.416b, x=\"block\", y=\"detected\", colour_by=\"discard\", \n        other_fields=\"phenotype\") + facet_wrap(~phenotype) + \n        scale_y_log10() + ggtitle(\"Detected features\"),\n    plotColData(sce.416b, x=\"block\", y=\"subsets_Mito_percent\", \n        colour_by=\"discard\", other_fields=\"phenotype\") + \n        facet_wrap(~phenotype) + ggtitle(\"Mito percent\"),\n    plotColData(sce.416b, x=\"block\", y=\"altexps_ERCC_percent\", \n        colour_by=\"discard\", other_fields=\"phenotype\") + \n        facet_wrap(~phenotype) + ggtitle(\"ERCC percent\"),\n    ncol=1\n)\n\n\n\n图 4.1: 数据集中每个批次和表型的 QC 指标分布。每个点代表一个细胞，并分别根据其是否被丢弃而着色。\n\n\n\n另一个有用的诊断涉及绘制线粒体计数与其他一些 QC 指标的比例。 目的是确认没有细胞同时具有大量总计数和大量线粒体计数，以确保我们不会无意中去除恰好具有高度代谢活性的高质量细胞（例如肝细胞）。\n\n加载数据ZeiselBrainData：工作流第2章library(scRNAseq)\nsce.zeisel &lt;- ZeiselBrainData()\nsce.zeisel\n#&gt; class: SingleCellExperiment \n#&gt; dim: 20006 3005 \n#&gt; metadata(0):\n#&gt; assays(1): counts\n#&gt; rownames(20006): Tspan12 Tshz1 ... mt-Rnr1 mt-Nd4l\n#&gt; rowData names(1): featureType\n#&gt; colnames(3005): 1772071015_C02 1772071017_G12 ... 1772066098_A12\n#&gt;   1772058148_F03\n#&gt; colData names(10): tissue group # ... level1class level2class\n#&gt; reducedDimNames(0):\n#&gt; mainExpName: endogenous\n#&gt; altExpNames(2): ERCC repeat\n\nlibrary(scater)\nsce.zeisel &lt;- aggregateAcrossFeatures(sce.zeisel, \n    id=sub(\"_loc[0-9]+$\", \"\", rownames(sce.zeisel)))\n\n#--- gene-annotation ---#\nlibrary(org.Mm.eg.db)\nrowData(sce.zeisel)$Ensembl &lt;- mapIds(org.Mm.eg.db, \n    keys=rownames(sce.zeisel), keytype=\"SYMBOL\", column=\"ENSEMBL\")\n\n\n\nCodesce.zeisel &lt;- addPerCellQC(\n  sce.zeisel,subsets=list(Mt=rowData(sce.zeisel)$featureType==\"mito\"))\n\nqc &lt;- quickPerCellQC(colData(sce.zeisel), \n    sub.fields=c(\"altexps_ERCC_percent\", \"subsets_Mt_percent\"))\nsce.zeisel$discard &lt;- qc$discard\n\nplotColData(sce.zeisel, x=\"sum\", y=\"subsets_Mt_percent\", colour_by=\"discard\")\n\n\n\nZeisel 大脑数据集 中分配给线粒体转录本的 UMI 百分比，与 UMI 总数作图。每个点代表一个细胞，并根据它是否被视为低质量并丢弃进行着色。\n\n\n\n\nCodeplotColData(sce.zeisel, x=\"altexps_ERCC_percent\", y=\"subsets_Mt_percent\",\n    colour_by=\"discard\")\n\n\n\nZeisel 大脑数据集中分配给线粒体转录本的 UMI 百分比,与分配给加标转录本的UMI百分比作图。每个点代表一个细胞，并根据它是否被视为低质量并丢弃进行着色。"
  },
  {
    "objectID": "QC.html#去除劣质细胞",
    "href": "QC.html#去除劣质细胞",
    "title": "\n4  质量控制\n",
    "section": "\n4.4 去除劣质细胞",
    "text": "4.4 去除劣质细胞\n对于常规分析，删除\n\nCodefiltered &lt;- sce.416b[,!reasons$discard]\n\n\n标记\n\nCodemarked &lt;- sce.416b\nmarked$discard &lt;- reasons$discard"
  },
  {
    "objectID": "normalization.html#库大小归一化",
    "href": "normalization.html#库大小归一化",
    "title": "\n5  Normalization\n",
    "section": "\n5.1 库大小归一化",
    "text": "5.1 库大小归一化\n库大小归一化是执行缩放归一化的最简单策略。我们将文库大小定义为每个细胞所有基因的计数总和，假设其期望值随任何细胞特异性偏差而缩放。然后，每个细胞的”文库缩放因子”与其文库大小成正比，其中定义了比例常数，使得所有单元的平均缩放因子等于 1。 此定义可确保归一化表达式值与原始计数的比例相同，这对于解释很有用， 尤其是在处理转换后的数据。\n\nCodelibrary(scater)\nlib.sf.zeisel &lt;- librarySizeFactors(sce.zeisel)\nsummary(lib.sf.zeisel)\n#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n#&gt;  0.1757  0.5680  0.8680  1.0000  1.2783  4.0839\n\n\n\nCodehist(log10(lib.sf.zeisel), xlab=\"Log10[Size factor]\", col='grey80')\n\n\n\nZeisel 大脑数据集中从文库大小得出的缩放因子分布"
  },
  {
    "objectID": "normalization.html#通过反卷积进行归一化",
    "href": "normalization.html#通过反卷积进行归一化",
    "title": "\n5  Normalization\n",
    "section": "\n5.2 通过反卷积进行归一化",
    "text": "5.2 通过反卷积进行归一化"
  }
]